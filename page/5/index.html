<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="优秀是一种习惯，坚持是一种品质。">
<meta property="og:type" content="website">
<meta property="og:title" content="黄俊彬个人博客">
<meta property="og:url" content="https://junbin1011.github.io/page/5/index.html">
<meta property="og:site_name" content="黄俊彬个人博客">
<meta property="og:description" content="优秀是一种习惯，坚持是一种品质。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="黄俊彬个人博客">
<meta name="twitter:description" content="优秀是一种习惯，坚持是一种品质。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://junbin1011.github.io/page/5/"/>





  <title> 黄俊彬个人博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b3ffb4912eee79c795100275f268095c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">黄俊彬个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">优秀是一种习惯，坚持是一种品质。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/27/设计模式-观察者模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/27/设计模式-观察者模式/" itemprop="url">
                  设计模式-观察者模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-27T11:00:57+08:00">
                2017-02-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/27/设计模式-观察者模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/27/设计模式-观察者模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-观察者模式的定义及使用场景"><a href="#1-观察者模式的定义及使用场景" class="headerlink" title="1.观察者模式的定义及使用场景"></a>1.观察者模式的定义及使用场景</h1><p>观察者模式是一个使用率非常高的模式，它最常用的地方是GUI系统，订阅-发布系统。因为这个模式的一个重要作用就是解耦，将被观察者和观察者解耦，使得它们之间的依赖性更小。</p>
<h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>定义对象间一种一对多的依赖关系，使得每当一个对象改变状态，则所以依赖于它的对象都会得到通知并被自动更新</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><ul>
<li>关联行为场景，需要注意的是，关联行为时可拆分的，而不是“组合”关系；</li>
<li>事件多级触发场景</li>
<li>跨系统的消息交换场景，如消息队列、事件总线的处理机制</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170227104314607?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="2-观察者模式的优缺点"><a href="#2-观察者模式的优缺点" class="headerlink" title="2. 观察者模式的优缺点"></a>2. 观察者模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><ul>
<li>观察者和被观察者之间是抽象解耦，应对业务变化</li>
<li>增强系统灵活性、可扩展性<h2 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h2>在应用观察者模式时需要考虑一下开发效率和运行效率问题，程序中包括一个被观察者、多个观察者、开发和调试等内容会比较复杂，而且在Java中消息的通知默认是顺序执行，一个观察者卡顿，会影响整体的执行效率，在这种情况下，一般考虑采用异步的方式<h1 id="3-观察者模式的实现方式"><a href="#3-观察者模式的实现方式" class="headerlink" title="3. 观察者模式的实现方式"></a>3. 观察者模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface Observer &#123;</div><div class="line">    //更新方法</div><div class="line">    public void  update();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class ConcreteObsever implements Observer &#123;</div><div class="line">    @Override</div><div class="line">    public void update() &#123;</div><div class="line">        System.out.println(&quot;接收到信息，并进行处理！&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public abstract class Subject &#123;</div><div class="line">    //定义一个观察者数组</div><div class="line">    private List&lt;Observer&gt; observers = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    //增加一个观察者</div><div class="line">    public void addObserver(Observer o) &#123;</div><div class="line">        this.observers.add(o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //删除一个观察者</div><div class="line">    public void removeObserver(Observer o) &#123;</div><div class="line">        this.observers.remove(o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //通知所有观察者</div><div class="line">    public void notifyObservers() &#123;</div><div class="line">        for (Observer o : this.observers) &#123;</div><div class="line">            o.update();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class ConcreteSubject extends Subject &#123;</div><div class="line"></div><div class="line">    //具体的业务</div><div class="line">    public void doSomeThing() &#123;</div><div class="line">        super.notifyObservers();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line"></div><div class="line">    public static void main(String args[]) &#123;</div><div class="line">      //创建一个被观察者</div><div class="line">        ConcreteSubject subject=new ConcreteSubject();</div><div class="line">        Observer obs=new ConcreteObsever();</div><div class="line">        subject.addObserver(obs);</div><div class="line">        subject.doSomeThing();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="4-观察者模式在Android中的实际应用"><a href="#4-观察者模式在Android中的实际应用" class="headerlink" title="4. 观察者模式在Android中的实际应用"></a>4. 观察者模式在Android中的实际应用</h1><p>RecycleView是Android中最重要的控件之一，而RecycleView最重要的一个功能就是Adapter。通过我们往RecycleView添加数据后，都会调用Adapter的notifyDataSetChanged（）方法，这是为什么？<br>首先我们看下Adapter的实现，他是RecycleView的一个内部类。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line">public static abstract class Adapter&lt;VH extends ViewHolder&gt; &#123;</div><div class="line">private final AdapterDataObservable mObservable = new AdapterDataObservable();</div><div class="line">private boolean mHasStableIds = false;</div><div class="line"></div><div class="line">public abstract VH onCreateViewHolder(ViewGroup parent, int viewType);</div><div class="line"></div><div class="line">public abstract void onBindViewHolder(VH holder, int position);</div><div class="line"></div><div class="line">public void onBindViewHolder(VH holder, int position, List&lt;Object&gt; payloads) &#123;</div><div class="line">onBindViewHolder(holder, position);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final VH createViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">TraceCompat.beginSection(TRACE_CREATE_VIEW_TAG);</div><div class="line">final VH holder = onCreateViewHolder(parent, viewType);</div><div class="line">holder.mItemViewType = viewType;</div><div class="line">TraceCompat.endSection();</div><div class="line">return holder;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void bindViewHolder(VH holder, int position) &#123;</div><div class="line">holder.mPosition = position;</div><div class="line">if (hasStableIds()) &#123;</div><div class="line">holder.mItemId = getItemId(position);</div><div class="line">&#125;</div><div class="line">holder.setFlags(ViewHolder.FLAG_BOUND,</div><div class="line">ViewHolder.FLAG_BOUND | ViewHolder.FLAG_UPDATE | ViewHolder.FLAG_INVALID</div><div class="line">| ViewHolder.FLAG_ADAPTER_POSITION_UNKNOWN);</div><div class="line">TraceCompat.beginSection(TRACE_BIND_VIEW_TAG);</div><div class="line">onBindViewHolder(holder, position, holder.getUnmodifiedPayloads());</div><div class="line">holder.clearPayload();</div><div class="line">TraceCompat.endSection();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public int getItemViewType(int position) &#123;</div><div class="line">return 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void setHasStableIds(boolean hasStableIds) &#123;</div><div class="line">if (hasObservers()) &#123;</div><div class="line">throw new IllegalStateException(&quot;Cannot change whether this adapter has &quot; +</div><div class="line">&quot;stable IDs while the adapter has registered observers.&quot;);</div><div class="line">&#125;</div><div class="line">mHasStableIds = hasStableIds;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public long getItemId(int position) &#123;</div><div class="line">return NO_ID;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public abstract int getItemCount();</div><div class="line"></div><div class="line">public final boolean hasStableIds() &#123;</div><div class="line">return mHasStableIds;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void onViewRecycled(VH holder) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public boolean onFailedToRecycleView(VH holder) &#123;</div><div class="line">return false;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void onViewAttachedToWindow(VH holder) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void onViewDetachedFromWindow(VH holder) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final boolean hasObservers() &#123;</div><div class="line">return mObservable.hasObservers();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void registerAdapterDataObserver(AdapterDataObserver observer) &#123;</div><div class="line">mObservable.registerObserver(observer);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void unregisterAdapterDataObserver(AdapterDataObserver observer) &#123;</div><div class="line">mObservable.unregisterObserver(observer);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void onAttachedToRecyclerView(RecyclerView recyclerView) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void onDetachedFromRecyclerView(RecyclerView recyclerView) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyDataSetChanged() &#123;</div><div class="line">mObservable.notifyChanged();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemChanged(int position) &#123;</div><div class="line">mObservable.notifyItemRangeChanged(position, 1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemChanged(int position, Object payload) &#123;</div><div class="line">mObservable.notifyItemRangeChanged(position, 1, payload);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemRangeChanged(int positionStart, int itemCount) &#123;</div><div class="line">mObservable.notifyItemRangeChanged(positionStart, itemCount);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemRangeChanged(int positionStart, int itemCount, Object payload) &#123;</div><div class="line">mObservable.notifyItemRangeChanged(positionStart, itemCount, payload);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemInserted(int position) &#123;</div><div class="line">mObservable.notifyItemRangeInserted(position, 1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemMoved(int fromPosition, int toPosition) &#123;</div><div class="line">mObservable.notifyItemMoved(fromPosition, toPosition);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemRangeInserted(int positionStart, int itemCount) &#123;</div><div class="line">mObservable.notifyItemRangeInserted(positionStart, itemCount);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemRemoved(int position) &#123;</div><div class="line">mObservable.notifyItemRangeRemoved(position, 1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public final void notifyItemRangeRemoved(int positionStart, int itemCount) &#123;</div><div class="line">mObservable.notifyItemRangeRemoved(positionStart, itemCount);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们可以看到notifyDataSetChange（）中调用了mObservable.notifyChange()。继续看AdapterDataObservable类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">static class AdapterDataObservable extends Observable&lt;AdapterDataObserver&gt; &#123;</div><div class="line">public boolean hasObservers() &#123;</div><div class="line">return !mObservers.isEmpty();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void notifyChanged() &#123;</div><div class="line">for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123;</div><div class="line">mObservers.get(i).onChanged();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void notifyItemRangeChanged(int positionStart, int itemCount) &#123;</div><div class="line">notifyItemRangeChanged(positionStart, itemCount, null);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void notifyItemRangeChanged(int positionStart, int itemCount, Object payload) &#123;</div><div class="line"></div><div class="line">for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123;</div><div class="line">mObservers.get(i).onItemRangeChanged(positionStart, itemCount, payload);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void notifyItemRangeInserted(int positionStart, int itemCount) &#123;</div><div class="line"></div><div class="line">for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123;</div><div class="line">mObservers.get(i).onItemRangeInserted(positionStart, itemCount);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void notifyItemRangeRemoved(int positionStart, int itemCount) &#123;</div><div class="line"></div><div class="line">for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123;</div><div class="line">mObservers.get(i).onItemRangeRemoved(positionStart, itemCount);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public void notifyItemMoved(int fromPosition, int toPosition) &#123;</div><div class="line">for (int i = mObservers.size() - 1; i &gt;= 0; i--) &#123;</div><div class="line">mObservers.get(i).onItemRangeMoved(fromPosition, toPosition, 1);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Observable是一个被观察者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">public abstract class Observable&lt;T&gt; &#123;</div><div class="line">  /**</div><div class="line">  * The list of observers. An observer can be in the list at most</div><div class="line">  * once and will never be null.</div><div class="line">  */</div><div class="line">  protected final ArrayList&lt;T&gt; mObservers = new ArrayList&lt;T&gt;();</div><div class="line"></div><div class="line">  /**</div><div class="line">  * Adds an observer to the list. The observer cannot be null and it must not already</div><div class="line">  * be registered.</div><div class="line">  * @param observer the observer to register</div><div class="line">  * @throws IllegalArgumentException the observer is null</div><div class="line">  * @throws IllegalStateException the observer is already registered</div><div class="line">  */</div><div class="line">  public void registerObserver(T observer) &#123;</div><div class="line">  if (observer == null) &#123;</div><div class="line">  throw new IllegalArgumentException(&quot;The observer is null.&quot;);</div><div class="line">  &#125;</div><div class="line">  synchronized(mObservers) &#123;</div><div class="line">  if (mObservers.contains(observer)) &#123;</div><div class="line">  throw new IllegalStateException(&quot;Observer &quot; + observer + &quot; is already registered.&quot;);</div><div class="line">  &#125;</div><div class="line">  mObservers.add(observer);</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  /**</div><div class="line">  * Removes a previously registered observer. The observer must not be null and it</div><div class="line">  * must already have been registered.</div><div class="line">  * @param observer the observer to unregister</div><div class="line">  * @throws IllegalArgumentException the observer is null</div><div class="line">  * @throws IllegalStateException the observer is not yet registered</div><div class="line">  */</div><div class="line">  public void unregisterObserver(T observer) &#123;</div><div class="line">  if (observer == null) &#123;</div><div class="line">  throw new IllegalArgumentException(&quot;The observer is null.&quot;);</div><div class="line">  &#125;</div><div class="line">  synchronized(mObservers) &#123;</div><div class="line">  int index = mObservers.indexOf(observer);</div><div class="line">  if (index == -1) &#123;</div><div class="line">  throw new IllegalStateException(&quot;Observer &quot; + observer + &quot; was not registered.&quot;);</div><div class="line">  &#125;</div><div class="line">  mObservers.remove(index);</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  /**</div><div class="line">  * Remove all registered observers.</div><div class="line">  */</div><div class="line">  public void unregisterAll() &#123;</div><div class="line">  synchronized(mObservers) &#123;</div><div class="line">  mObservers.clear();</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AdapterDataObserver 的派生类RecyclerViewDataObserver： mObserver是RecycleView的一个变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private final RecyclerViewDataObserver mObserver = new RecyclerViewDataObserver();</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">private class RecyclerViewDataObserver extends AdapterDataObserver &#123;</div><div class="line">@Override</div><div class="line">public void onChanged() &#123;</div><div class="line">assertNotInLayoutOrScroll(null);</div><div class="line">if (mAdapter.hasStableIds()) &#123;</div><div class="line">// TODO Determine what actually changed.</div><div class="line">// This is more important to implement now since this callback will disable all</div><div class="line">// animations because we cannot rely on positions.</div><div class="line">mState.mStructureChanged = true;</div><div class="line">setDataSetChangedAfterLayout();</div><div class="line">&#125; else &#123;</div><div class="line">mState.mStructureChanged = true;</div><div class="line">setDataSetChangedAfterLayout();</div><div class="line">&#125;</div><div class="line">if (!mAdapterHelper.hasPendingUpdates()) &#123;</div><div class="line">requestLayout();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onItemRangeChanged(int positionStart, int itemCount, Object payload) &#123;</div><div class="line">assertNotInLayoutOrScroll(null);</div><div class="line">if (mAdapterHelper.onItemRangeChanged(positionStart, itemCount, payload)) &#123;</div><div class="line">triggerUpdateProcessor();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onItemRangeInserted(int positionStart, int itemCount) &#123;</div><div class="line">assertNotInLayoutOrScroll(null);</div><div class="line">if (mAdapterHelper.onItemRangeInserted(positionStart, itemCount)) &#123;</div><div class="line">triggerUpdateProcessor();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onItemRangeRemoved(int positionStart, int itemCount) &#123;</div><div class="line">assertNotInLayoutOrScroll(null);</div><div class="line">if (mAdapterHelper.onItemRangeRemoved(positionStart, itemCount)) &#123;</div><div class="line">triggerUpdateProcessor();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onItemRangeMoved(int fromPosition, int toPosition, int itemCount) &#123;</div><div class="line">assertNotInLayoutOrScroll(null);</div><div class="line">if (mAdapterHelper.onItemRangeMoved(fromPosition, toPosition, itemCount)) &#123;</div><div class="line">triggerUpdateProcessor();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void triggerUpdateProcessor() &#123;</div><div class="line">if (mPostUpdatesOnAnimation &amp;&amp; mHasFixedSize &amp;&amp; mIsAttached) &#123;</div><div class="line">ViewCompat.postOnAnimation(RecyclerView.this, mUpdateChildViewsRunnable);</div><div class="line">&#125; else &#123;</div><div class="line">mAdapterUpdateDuringMeasure = true;</div><div class="line">requestLayout();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>RecycleView的setAdapter方法，可以看到里面调用了unregisterAdapterDataObserver及registerAdapterDataObserver方法进行取消注册及注册。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">public void setAdapter(Adapter adapter) &#123;</div><div class="line"> // bail out if layout is frozen</div><div class="line"> setLayoutFrozen(false);</div><div class="line"> setAdapterInternal(adapter, false, true);</div><div class="line"> requestLayout();</div><div class="line"> &#125;</div><div class="line"></div><div class="line">private void setAdapterInternal(Adapter adapter, boolean compatibleWithPrevious,</div><div class="line"> boolean removeAndRecycleViews) &#123;</div><div class="line"> if (mAdapter != null) &#123;</div><div class="line"> mAdapter.unregisterAdapterDataObserver(mObserver);</div><div class="line"> mAdapter.onDetachedFromRecyclerView(this);</div><div class="line"> &#125;</div><div class="line"> if (!compatibleWithPrevious || removeAndRecycleViews) &#123;</div><div class="line"> // end all running animations</div><div class="line"> if (mItemAnimator != null) &#123;</div><div class="line"> mItemAnimator.endAnimations();</div><div class="line"> &#125;</div><div class="line"> // Since animations are ended, mLayout.children should be equal to</div><div class="line"> // recyclerView.children. This may not be true if item animator&apos;s end does not work as</div><div class="line"> // expected. (e.g. not release children instantly). It is safer to use mLayout&apos;s child</div><div class="line"> // count.</div><div class="line"> if (mLayout != null) &#123;</div><div class="line"> mLayout.removeAndRecycleAllViews(mRecycler);</div><div class="line"> mLayout.removeAndRecycleScrapInt(mRecycler);</div><div class="line"> &#125;</div><div class="line"> // we should clear it here before adapters are swapped to ensure correct callbacks.</div><div class="line"> mRecycler.clear();</div><div class="line"> &#125;</div><div class="line"> mAdapterHelper.reset();</div><div class="line"> final Adapter oldAdapter = mAdapter;</div><div class="line"> mAdapter = adapter;</div><div class="line"> if (adapter != null) &#123;</div><div class="line"> adapter.registerAdapterDataObserver(mObserver);</div><div class="line"> adapter.onAttachedToRecyclerView(this);</div><div class="line"> &#125;</div><div class="line"> if (mLayout != null) &#123;</div><div class="line"> mLayout.onAdapterChanged(oldAdapter, mAdapter);</div><div class="line"> &#125;</div><div class="line"> mRecycler.onAdapterChanged(oldAdapter, mAdapter, compatibleWithPrevious);</div><div class="line"> mState.mStructureChanged = true;</div><div class="line"> markKnownViewsInvalid();</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>到这里我们知道，setAdapter()方法会进行观察者的注册，当RecycleView的数据发送变化的时，调用了Adapter的notifyDataSetChange()，这个函数又会调用 AdapterDataObservable的notifyChanged（）；该函数会遍历所有的观察者的onChange函数，在 RecyclerViewDataObserver的onChange()函数中会获取Adapter中数据集的新数量，然后调用RecycleView的requestLayout（）方法重新进行布局，更新用户的界面。这就是一个观察者模式！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/24/设计模式-组合模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/24/设计模式-组合模式/" itemprop="url">
                  设计模式-组合模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-24T09:32:45+08:00">
                2017-02-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/24/设计模式-组合模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/24/设计模式-组合模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-组合模式的定义及使用场景"><a href="#1-组合模式的定义及使用场景" class="headerlink" title="1.组合模式的定义及使用场景"></a>1.组合模式的定义及使用场景</h1><p>组合模式也称为部分整体模式，结构型设计模式之一，组合模式比较简单，它将一组相似的对象看作一个对象处理，并根据一个树状结构来组合对象，然后提供一个统一的方法去访问相应的对象，以此忽略掉对象与对象集合之间的差别。生活中一个比较经典的例子就是组织结构的树状图。<br><img src="http://img.blog.csdn.net/20170224092806967?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>将对象组合成树形结构以表示“部分-整体”的层次结构，使得用户对单个对象和组合对象的使用具有一致性</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><ul>
<li>维护和展示部分-整体关系的场景，如树形菜单、文件和文件夹管理</li>
<li>从一个整体中能够独立出部分模块或功能的场景</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170224092825249?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="2-组合模式的优缺点"><a href="#2-组合模式的优缺点" class="headerlink" title="2. 组合模式的优缺点"></a>2. 组合模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><ul>
<li>组合模式可以清楚地定义分层次的复杂对象，表示对象的全部或部分层次，它让高层模块忽略了层次的差异，方便对整个层级结构进行控制</li>
<li>高层模块可以一致地使用一个组合结构或其中单个对象，不必关心处理的是单个对象还是整个组合结构，简化了高层模块的代码</li>
<li>在组合模式中增加新的枝干构件和叶子构件都很方便，无需对现有类库进行任何修改</li>
<li>组合模式为树形结构的面向对象实现提供了一种灵活的解决方案，通过叶子对象和枝干对象的递归组合，可以形成复杂的树形结构，但对树形结构的控制却非常简单<br>##2.2缺点<br>在新增构件时不好对枝干中的构件类型进行限制，不能依赖类型系统来施加这些约束，因为在大多数情况下，他们都来自于相同的抽象层，此时，必须进行类型检查来实现，过程比较复杂<h1 id="3-注意事项"><a href="#3-注意事项" class="headerlink" title="3.注意事项"></a>3.注意事项</h1>组合模式有两种不同的实现：透明模式和安全模式（4点中为安全模式），透明模式是把用来组合使用的方法放到抽象类中，不管叶子对象还是树枝对象都有相同的结构。这种模式的缺点是通过判断getChildren的返回值确认是叶子节点还是树枝节点，如果处理不当，会在运行期出现问题，安全模式它是把树枝节点和叶子节点彻底分开，树枝节点单独拥有用来组合的方法。<h1 id="4-组合模式的实现方式"><a href="#4-组合模式的实现方式" class="headerlink" title="4. 组合模式的实现方式"></a>4. 组合模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public abstract class Component &#123;</div><div class="line">    public void doSomething() &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class Composite extends Component &#123;</div><div class="line">    private ArrayList&lt;Component&gt; componentArrayList = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    public void add(Component component) &#123;</div><div class="line">        componentArrayList.add(component);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void remove(Component component) &#123;</div><div class="line">        componentArrayList.remove(component);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public ArrayList&lt;Component&gt; getChildren() &#123;</div><div class="line">        return this.componentArrayList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void doSomething() &#123;</div><div class="line">        System.out.println(&quot;Composite do something&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class Leaf extends  Component &#123;</div><div class="line">    @Override</div><div class="line">    public void doSomething() &#123;</div><div class="line">        System.out.println(&quot;Leaf do someThing&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line"></div><div class="line">    public static void main(String args[]) &#123;</div><div class="line">        //创建一个根节点</div><div class="line">        Composite root = new Composite();</div><div class="line">        root.doSomething();</div><div class="line">        //创建一个树枝构件</div><div class="line">        Composite barnch = new Composite();</div><div class="line">        //创建一个叶子节点</div><div class="line">        Leaf leaf = new Leaf();</div><div class="line">        //建立整体</div><div class="line">        root.add(barnch);</div><div class="line">        barnch.add(leaf);</div><div class="line">        //遍历</div><div class="line">        display(root);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void display(Composite composite) &#123;</div><div class="line">        for (Component c : composite.getChildren()) &#123;</div><div class="line">            if (c instanceof Leaf) &#123;</div><div class="line">                c.doSomething();</div><div class="line">            &#125; else &#123;</div><div class="line">                display((Composite) c);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="5-组合模式在Android中的实际应用"><a href="#5-组合模式在Android中的实际应用" class="headerlink" title="5. 组合模式在Android中的实际应用"></a>5. 组合模式在Android中的实际应用</h1><p>Android源码中关于组合模式有一个非常经典的实现，我们几乎每天都会使用到，那就是View和ViewGroup的嵌套组合。</p>
<p><img src="http://img.blog.csdn.net/20170224092900053?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>这里省略了View和ViewGroup的一些方法，在Android的这个视图层级中，容器一定是ViewGroup，而且只有ViewGroup才能包含其他的View，例如Realyout能包含TextView、Button等，但反过来TextView不能包含Relayout，因为TextView直接继承了View，并不是一个容器，这里View的视图层级中使用的其实是一种安全的设计模式。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/23/设计模式-迭代器模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/23/设计模式-迭代器模式/" itemprop="url">
                  设计模式-迭代器模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-23T09:33:00+08:00">
                2017-02-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/23/设计模式-迭代器模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/23/设计模式-迭代器模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-迭代器模式的定义及使用场景"><a href="#1-迭代器模式的定义及使用场景" class="headerlink" title="1.迭代器模式的定义及使用场景"></a>1.迭代器模式的定义及使用场景</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>迭代器模式又称游标模式，是行为型设计模式之一。其源于对容器的访问，比较java的List、Map、数组等。如果将容器遍历的方法封装在容器中，容器类不仅要维护自身内部的数据元素而且还要对外提供遍历的接口方法，如果不提供遍历的方法而让使用者自己去实现，又会让容器的内部细节暴露。正因于此，迭代模式应运而生。<br>迭代器模式提供一种方法顺序访问一个容器对象的各个元素，而又不需要暴露该对象的内部表示</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><p>遍历一个容器对象<br><strong>重点内容</strong><br><img src="http://img.blog.csdn.net/20170223093052345?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="2-迭代器模式的优缺点"><a href="#2-迭代器模式的优缺点" class="headerlink" title="2. 迭代器模式的优缺点"></a>2. 迭代器模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><p>可以遍历容器而又不暴露该对象的内部表示，弱化了容器类和遍历算法之间的关系</p>
<h2 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h2><p>增加类文件</p>
<h1 id="3-注意事项"><a href="#3-注意事项" class="headerlink" title="3.注意事项"></a>3.注意事项</h1><h2 id="3-1使用for循环与使用迭代器iterator的对比"><a href="#3-1使用for循环与使用迭代器iterator的对比" class="headerlink" title="3.1使用for循环与使用迭代器iterator的对比"></a>3.1使用for循环与使用迭代器iterator的对比</h2><p>效率上的各有有事<br>采用ArrayList对随机访问比较快，而for循环中的get()方法，采用的即是随机访问的方法，因此在ArrayList里，for循环较快<br>采用LinkedList则是顺序访问比较快，iterator中的next()方法，采用的即是顺序访问的方法，因此在LinkedList里，使用iterator较快<br>从数据结构角度分析,for循环适合访问顺序结构,可以根据下标快速获取指定元素.而Iterator 适合访问链式结构,因为迭代器是通过next()和Pre()来定位的.可以访问没有顺序的集合.</p>
<p>而使用 Iterator 的好处在于可以使用相同方式去遍历集合中元素，而不用考虑集合类的内部实现（只要它实现了 java.lang.Iterable 接口），如果使用 Iterator 来遍历集合中元素，一旦不再使用 List 转而使用 Set 来组织数据，那遍历元素的代码不用做任何修改，如果使用 for 来遍历，那所有遍历此集合的算法都得做相应调整,因为List有序,Set无序,结构不同,他们的访问算法也不一样.</p>
<h2 id="3-2foreach和Iterator的关系"><a href="#3-2foreach和Iterator的关系" class="headerlink" title="3.2foreach和Iterator的关系"></a>3.2foreach和Iterator的关系</h2><p>for each是jdk5.0新增加的一个循环结构，可以用来处理集合中的每个元素而不用考虑集合定下标。<br>格式如下<br>for(variable:collection){ statement; }<br>定义一个变量用于暂存集合中的每一个元素，并执行相应的语句(块)。collection必须是一个数组或者是一个实现了lterable接口的类对象。 使用for each循环语句的优势在于更加简洁，更不容易出错，不必关心下标的起始值和终止值</p>
<h1 id="4-迭代器模式的实现方式"><a href="#4-迭代器模式的实现方式" class="headerlink" title="4. 迭代器模式的实现方式"></a>4. 迭代器模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public interface Iterator &#123;</div><div class="line">    public  Object next();</div><div class="line">    public boolean hasNext();</div><div class="line">    public  boolean remove();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">public class ConcreteIteractor implements  Iterator &#123;</div><div class="line">    private  Vector vevcor=new Vector&lt;&gt;();</div><div class="line">    private int curosr=0;</div><div class="line"></div><div class="line">    public ConcreteIteractor(Vector vevcor) &#123;</div><div class="line">        this.vevcor = vevcor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Object next() &#123;</div><div class="line">        Object result=null;</div><div class="line">        if(this.hasNext())&#123;</div><div class="line">            result=this.vevcor.get(this.curosr++);</div><div class="line">        &#125;else&#123;</div><div class="line">            result=null;</div><div class="line">        &#125;</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean hasNext() &#123;</div><div class="line">        if(this.curosr==this.vevcor.size())&#123;</div><div class="line">            curosr=0;</div><div class="line">            return  false;</div><div class="line"></div><div class="line">        &#125;else&#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean remove() &#123;</div><div class="line">        this.vevcor.remove(this.curosr);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface Aggregate &#123;</div><div class="line">    public void add(Object object);</div><div class="line"></div><div class="line">    public void remove(Object remove);</div><div class="line"></div><div class="line">    public Iterator iterator();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class ConcreteAggragate implements Aggregate &#123;</div><div class="line">    private Vector vevcor = new Vector&lt;&gt;();</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void add(Object object) &#123;</div><div class="line">        this.vevcor.add(object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void remove(Object remove) &#123;</div><div class="line">        this.vevcor.remove(remove);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Iterator iterator() &#123;</div><div class="line">        return new ConcreteIteractor(vevcor);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="5-迭代器模式在Android中的实际应用"><a href="#5-迭代器模式在Android中的实际应用" class="headerlink" title="5. 迭代器模式在Android中的实际应用"></a>5. 迭代器模式在Android中的实际应用</h1><p>迭代器这个模式对开发者来说几乎不会自己去实现一个迭代器，Android中，其除了各种数据结构体，如List、Map等所包含的迭代器外，Android自身源码中也为我们提供了迭代器遍历数据。最为典型的例子就是Cursor游标对象，该游标对象实质就是一个具体的迭代器，我们可以使用它来遍历数据库查询所得的结果集。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/22/设计模式-适配器模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/22/设计模式-适配器模式/" itemprop="url">
                  设计模式-适配器模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-22T10:10:25+08:00">
                2017-02-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/22/设计模式-适配器模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/22/设计模式-适配器模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-适配器模式的定义及使用场景"><a href="#1-适配器模式的定义及使用场景" class="headerlink" title="1.适配器模式的定义及使用场景"></a>1.适配器模式的定义及使用场景</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>适配器模式在我们的开发中使用率非常高，从代码中随处可见的Adapter就可以看出来，从最早的ListView、GridView，到现在最新的RecycleView都需要用到Adapter。说到底，适配器就是将两个不兼容的类融合在一起，它有点像粘合剂，将不同的东西通过一种转换使得他们能够协作起来。<br>适配器模式把一个类在接口变换成客户端所期待的另一种接口，从而使原本因接口不匹配而无法再一起工作的两个类能够在一起工作</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><ul>
<li>系统需要使用现有的类，而此类的接口不符合系统的需要，即接口不兼容</li>
<li>想要建立一个可以重复使用的类，用于与一些彼此之间没有太大关联的一些类，包括一些可能在将来引进的类一起工作</li>
<li>需要一个统一的输出接口，而输入端的类型不可预知</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170222100849043?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="2-适配器模式的优缺点"><a href="#2-适配器模式的优缺点" class="headerlink" title="2. 适配器模式的优缺点"></a>2. 适配器模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><ul>
<li>适配器模式可以让两个没有任何关系的类在一起运行</li>
<li>增加了类的透明度，提高类的复用度</li>
<li>增强灵活性<h2 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h2>过多地使用适配器，会让系统增加复杂度，不易整体把握。例如，明明看到调用的是A接口，其实内部被适配成了B接口的实现。因此，如果不是很有必要，可以不使用适配器，而是直接对系统进行必要的重构<h1 id="3-注意实现"><a href="#3-注意实现" class="headerlink" title="3.注意实现"></a>3.注意实现</h1>适配器模式最好在详细设计阶段不要考虑，它不是为了解决还出在开发阶段的问题，而是解决正在服役的项目问题，系统扩展了，不符合原有设计的时候才考虑通过适配器模式减少代码修改带来的风险。<h1 id="4-适配器模式的实现方式"><a href="#4-适配器模式的实现方式" class="headerlink" title="4. 适配器模式的实现方式"></a>4. 适配器模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface Target &#123;</div><div class="line">    public void request();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class ConcreteTarget implements Target &#123;</div><div class="line">    @Override</div><div class="line">    public void request() &#123;</div><div class="line">        System.out.println(&quot;ConcreteTarget is doing request!&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class Adaptee &#123;</div><div class="line">    public void doSomeThing() &#123;</div><div class="line">        System.out.println(&quot;Adaptee is doSomeThing now!！！！&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class Adapter extends Adaptee implements Target &#123;</div><div class="line">    @Override</div><div class="line">    public void request() &#123;</div><div class="line">        super.doSomeThing();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line"></div><div class="line">    public static void main(String args[]) &#123;</div><div class="line">        Target target = new ConcreteTarget();</div><div class="line">        target.request();</div><div class="line">        Target adapterTarget = new Adapter();</div><div class="line">        adapterTarget.request();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="5-适配器模式在Android中的实际应用"><a href="#5-适配器模式在Android中的实际应用" class="headerlink" title="5. 适配器模式在Android中的实际应用"></a>5. 适配器模式在Android中的实际应用</h1><p>ListView作为重要的控件，它需要能够显示各种各样的视图（ItemView），每个人需要的显示效果各不同。显示的数据类型、数量等也千变万化，那么如何应对这种变化成为架构师需要考虑的重要特性之一。</p>
<p>Android的做法是增加一个Adapter层来隔离变化，将ListView需要的关于Item View接口抽象到Adapter对象中，并且在ListView内部调用Adapter这些接口完成布局操作。这样只用用户实现了Adapter的接口，并且将该Adapter设置给ListView，ListView就可以按照用户设定的UI效果、数量、数据来显示每一项数据。</p>
<p>ListView最重要的问题是要解决每一项Item视图的输出，ItemView千变万化，但终究它是View类型，Adapter将统一ItemView 输出为View，这样就很好的应对了ItemView的可变性。这虽然有些脱离Adapter模式将不兼容的接口转换为可用接口的使用场景，但也是Adapter模式的一种变种实现。这里的Target角色就是View，Adapter角色就是将ItemView输出为View抽象的角色，Adaptee就是需要被处理的ItemView。</p>
<p>通过增加Adapter一层来将ItemView的操作抽象起来，ListView等集合视图通过Adapter对象获取Item的个数、数据、ItemView等，从而达到适配各种数据、各种Item视图的效果。因为ItemView和数据类型千变万化，Android的架构师将这种变化的部分交给用户来处理，通过getCount，getItem，getView等几个抽象出来，也就是将ItemView的构造过程交给用户来处理，灵活地运用了设配器的模式，达到了无限适配，拥抱变化的目的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/21/设计模式-策略模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/21/设计模式-策略模式/" itemprop="url">
                  设计模式-策略模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-21T10:11:13+08:00">
                2017-02-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/21/设计模式-策略模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/21/设计模式-策略模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-策略模式的定义及使用场景"><a href="#1-策略模式的定义及使用场景" class="headerlink" title="1.策略模式的定义及使用场景"></a>1.策略模式的定义及使用场景</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>在软件的开发中常常遇到一个情况，实现某一个功能可以有多种算法或则策略，我们根据实际情况选择不同的算法或则策略来完成该功能。针对这种情况，一种常规的方法是将多种算法写在一个类中，通过if-else等条件判断语句来选择具体的算法，但明显违背了开闭原则和单一责任原则。如果将这些算法或则策略抽象出来，提供一个统一的接口，不同的算法或则策略有不同的实现，这样在程序客户端就可以通过注入不同的实现对象来实现算法或则策略的动态替换，这种模式的扩展性、可维护性更高。<br>策略模式定义了一系列的算法，并将每一个算法封装起来，而且使他们还可以互相替换。策略模式让算法独立于使用它的客户而独立变化</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><ul>
<li>针对同一类型问题的多种处理方式，仅仅是具体行为有差别时</li>
<li>需要安全地封装多种同一类型的操作时</li>
<li>出现同一抽象类有多个子类，而又需要使用if-else或者switch-case来选择具体子类时</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170221100602329?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="2-策略模式的优缺点"><a href="#2-策略模式的优缺点" class="headerlink" title="2. 策略模式的优缺点"></a>2. 策略模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><ul>
<li>算法可以自由切换</li>
<li>避免使用多重条件判断</li>
<li>扩展性良好<h2 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h2></li>
<li>策略类数量增多</li>
<li>所有的策略类都需要多外暴露<h1 id="3-注意实现"><a href="#3-注意实现" class="headerlink" title="3.注意实现"></a>3.注意实现</h1>如果系统中的一个策略家族的具体策略数量超过4个，则需要考虑使用混合模式，解决策略类膨胀和对外暴露问题，否则将增大日后的维护成本<h1 id="4-策略模式的实现方式"><a href="#4-策略模式的实现方式" class="headerlink" title="4. 策略模式的实现方式"></a>4. 策略模式的实现方式</h1></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface Strategy &#123;</div><div class="line">   public void doSomeThing();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class ConcreteStrategy1 implements Strategy &#123;</div><div class="line">    @Override</div><div class="line">    public void doSomeThing() &#123;</div><div class="line">        System.out.println(&quot;具体算法1的运算法则...&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class ConcreteStrategy2 implements Strategy &#123;</div><div class="line">    @Override</div><div class="line">    public void doSomeThing() &#123;</div><div class="line">        System.out.println(&quot;具体算法2的运算法则...&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class Context &#123;</div><div class="line">    private Strategy strategy;</div><div class="line"></div><div class="line">    public Context(Strategy strategy) &#123;</div><div class="line">        this.strategy = strategy;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setStrategy(Strategy strategy) &#123;</div><div class="line">        this.strategy = strategy;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void doSomeThing() &#123;</div><div class="line">        strategy.doSomeThing();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>public class Test {
    public static void main(String args[]) {
        Strategy concreteStrategy1 = new ConcreteStrategy1();
        Strategy concretStrategy2 = new ConcreteStrategy2();
        Context context = new Context(concreteStrategy1);
        context.doSomeThing();
        context.setStrategy(concretStrategy2);
        context.doSomeThing();
    }
}
</code></pre><h1 id="5-策略模式在Android中的实际应用"><a href="#5-策略模式在Android中的实际应用" class="headerlink" title="5. 策略模式在Android中的实际应用"></a>5. 策略模式在Android中的实际应用</h1><p>在 RecyclerView 还没火起来前，ListView 是一个很重要的组件，我们通常在布局里写个 ListView 组件，然后在代码中 setAdapter，把 View 与 Model 结合的任务交给了 Adapter。</p>
<p>比如 ListView 要显示的子布局是个简单的文字时，我们可以使用 ArrayAdapter :<br><img src="http://img.blog.csdn.net/20170221100750302?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>要显示复杂些的布局时，就需要用 BaseAdapter ：<br><img src="http://img.blog.csdn.net/20170221100806552?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>我们可以看到，当更换 Adapter 的具体实现时，仍然调用的是 ListView.setAdapter(…) 方法，查看 ListView 源码，发现 setAdapter 方法的参数是一个 ListAdapter:<br><img src="http://img.blog.csdn.net/20170221100817896?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>继续看 ListAdapter 源码和类结构：<br><img src="http://img.blog.csdn.net/20170221100829302?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>可以看到 ListAdapter 是一个接口，ArrayAdapter 和 BaseAdapter 是它的一个实现类。对比文章开始给出的 策略模式 UML 图，可以发现 ListAdapter 就是 strategy 接口，ArrayAdpater 等就是具体的实现类，而在 ListView 中引用的是 接口 ListAdapter，可以证实这就是一个 策略模式 的使用。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/20/设计模式-装饰模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/设计模式-装饰模式/" itemprop="url">
                  设计模式-装饰模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-20T13:59:01+08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/20/设计模式-装饰模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/20/设计模式-装饰模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-装饰模式的定义及使用场景"><a href="#1-装饰模式的定义及使用场景" class="headerlink" title="1.装饰模式的定义及使用场景"></a>1.装饰模式的定义及使用场景</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>装饰模式也称为包装模式，结构型设计模式之一，其使用一种对客户端透明的方式来动态地扩展对象的功能，同时它也是继承关系的一种替代方案之一。动态地给一个对象添加一些额外的职责。就增加功能来说，装饰模式相比生成子类更为灵活</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><ul>
<li>需要扩展一个类的功能，或给一个类增加附加功能</li>
<li>需要动态地给一个对象增加功能，这些功能可以再动态地撤销</li>
<li>需要为一批的兄弟类进行改装或加装功能，当然是首选装饰模式</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170220135552081?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="2-装饰模式的优缺点"><a href="#2-装饰模式的优缺点" class="headerlink" title="2. 装饰模式的优缺点"></a>2. 装饰模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><ul>
<li>装饰类和被装饰类可以独立发展，而不会相互耦合。换句话说，Component类无需知道Decorator类，Decorator类是从外部来扩展Component类的功能，而Decorator也不用知道具体的构件</li>
<li>装饰模式是继承关系的一个替代方案。我们看装饰类Decorator，不管装饰多少层，返回的对象还是component，实现的还是is-a的关系</li>
<li>装饰模式可以动态地扩展一个实现类的功能<h2 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h2>对于装饰模式，多层装饰是比较复杂的。因尽量减少装饰类的数量，以便减低系统的复杂度。<h1 id="3-装饰模式的实现方式"><a href="#3-装饰模式的实现方式" class="headerlink" title="3. 装饰模式的实现方式"></a>3. 装饰模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public abstract  class Component &#123;</div><div class="line">    public abstract void operator();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class ConcreteComponent extends Component &#123;</div><div class="line">    @Override</div><div class="line">    public void operator() &#123;</div><div class="line">        System.out.println(&quot;ConcreteComponent operator&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class Decorator extends Component &#123;</div><div class="line">    private Component component;</div><div class="line"></div><div class="line">    Decorator(Component component) &#123;</div><div class="line">        this.component = component;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void operator() &#123;</div><div class="line">        if (component != null) &#123;</div><div class="line">            component.operator();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class ConcreteDecorator1 extends Decorator &#123;</div><div class="line">    public ConcreteDecorator1(Component component) &#123;</div><div class="line">        super(component);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void method1() &#123;</div><div class="line">        System.out.println(&quot;method1 修饰&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void operator() &#123;</div><div class="line">        super.operator();</div><div class="line">        method1();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class ConcreteDecorator2 extends Decorator &#123;</div><div class="line">    public ConcreteDecorator2(Component component) &#123;</div><div class="line">        super(component);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void method2() &#123;</div><div class="line">        System.out.println(&quot;method2 修饰&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void operator() &#123;</div><div class="line">        super.operator();</div><div class="line">        method2();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">    public static void main(String args[]) &#123;</div><div class="line">        Component component = new ConcreteComponent();</div><div class="line">        ConcreteDecorator1 decorator1 = new ConcreteDecorator1(component);</div><div class="line">        ConcreteDecorator2 decorator2 = new ConcreteDecorator2(component);</div><div class="line">        decorator1.operator();</div><div class="line">        decorator2.operator();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="4-装饰模式在Android中的实际应用"><a href="#4-装饰模式在Android中的实际应用" class="headerlink" title="4. 装饰模式在Android中的实际应用"></a>4. 装饰模式在Android中的实际应用</h1><p>Context类本身是一个纯abstract类，他有两个具体的实现子类：ContextImpl和ContextWrapper。其中ContextWrapper类，只是一个包装而已，ContextWrapper构造函数中必须包含一个真正的Context引用，同时ContextWrapper提供了attachBaseContext（）用于给ContextWrapper对象中指定真正的Context对象，调用ContextWrapper的方法都会被转向其所包含的真正的Context对象。</p>
<p>ContextThemeWrapper类，其内部包含了与主题（Theme）相关的接口，这里所说的主题就是指在AndroidMainifest.xml中通过android：theme为Application元素或者Activity元素指定的主题。当然，只有Activity才需要主题，Service是不需要主题的，Application同理。</p>
<p>而ContextImpl类则真正实现了Context中的所有函数，应用程序中所调用的各种Context类的方法，其实现均来于该类。Context的两个子类分工明确，其中ContextImpl是Context的具体实现类，ContextWrapper是Context的包装类。</p>
<p><a href="http://blog.csdn.net/junbin1011/article/details/54612858" target="_blank" rel="external">详见 Android之Context底层原理,http://blog.csdn.net/junbin1011/article/details/54612858</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/17/Android事件分发底层原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/17/Android事件分发底层原理/" itemprop="url">
                  Android事件分发底层原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T16:03:53+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/17/Android事件分发底层原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/17/Android事件分发底层原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h1><h2 id="1-1事件构成"><a href="#1-1事件构成" class="headerlink" title="1.1事件构成"></a>1.1事件构成</h2><p>在Android中，事件（TouchEvent）主要包括点按、长按、拖拽、滑动等，所有的事件都由如下三个部分组成</p>
<ul>
<li><p>按下（ACTION_DOWN）</p>
</li>
<li><p>移动（ACTION_MOVE）</p>
</li>
<li><p>抬起（ACTION_UP）</p>
</li>
</ul>
<p>一般来说，一次完整的Touch事件，应该是由一个Down、一个Up和若干个Move组成。</p>
<h2 id="1-2View的分发事件"><a href="#1-2View的分发事件" class="headerlink" title="1.2View的分发事件"></a>1.2View的分发事件</h2><ul>
<li><p>public boolean dispatchTouchEvent（MotionEvent ev）<br>如果事件能够传递到当前的View，那么此方法一定会被调用。</p>
</li>
<li><p>public boolean onInterceptTouchEvent（MotionEvent ev）<br>用来判断是否拦截某个事件</p>
</li>
<li><p>public boolean onTouchEvent(MotionEvent ev)<br>用来处理点击事件</p>
</li>
</ul>
<p>ViewGroup的相关事件有三个：onInterceptTouchEvent、dispatchTouchEvent、onTouchEvent。View的相关事件只有两个：dispatchTouchEvent、onTouchEvent。</p>
<h2 id="1-3滑动冲突处理："><a href="#1-3滑动冲突处理：" class="headerlink" title="1.3滑动冲突处理："></a>1.3滑动冲突处理：</h2><p>（1）外部拦截方法 （在父容器的 onInterceptTouchEvent 进行控制，是否分发到子元素），遵循Android规范</p>
<p>（2）内部拦截方法（在子元素通过控制父容器的 requestDisallowInterceptTouchEvent 进行控制）</p>
<h1 id="2-流程"><a href="#2-流程" class="headerlink" title="2.流程"></a>2.流程</h1><p>Android中事件传递按照从上到下再从下到上进行层级传递，事件处理从Activity开始到ViewGroup再到View，如果View没有消费事件会再次从View到ViewGroup再到Activity最后事件被抛出消费掉。流转的流程图如下：<br><img src="http://img.blog.csdn.net/20170217154756479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<ul>
<li><p>dispatchTouchEvent和TouchEvnet return false的 时候，事件都会回传给父控件的onTouchEvent处理</p>
</li>
<li><p>onInterceptTouchEvent默认为false不进行事件拦截，OnDispatchTouchEvnet默认为true进行事件分发，onTouchEvent需要根据具体的View是否设置了listener及具体View的实现进行区分是否为true</p>
</li>
<li><p>Activity的dispatchTouchEvent不管返回true或false都会进行分发</p>
</li>
<li><p>如果事件在具体的View或者ViewGroup的onTouchEvent返回true，则表明事件被消费，事件传递机制就会结束</p>
<h1 id="3-示例"><a href="#3-示例" class="headerlink" title="3.示例"></a>3.示例</h1><p>具体可以根据流程图修改对应方法返回值进行日志验证。这里就不一一进行日志输出显示。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">public class MyView extends Button &#123;</div><div class="line">    private String TAG = &quot;MyView&quot;;</div><div class="line"></div><div class="line">    public MyView(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">        TAG += getTag();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line">        switch (ev.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.i(TAG, &quot;MyView dispatchTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.i(TAG, &quot;MyView dispatchTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.i(TAG, &quot;MyView dispatchTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        return super.dispatchTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</div><div class="line">        switch (event.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.i(TAG, &quot;MyView onTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.i(TAG, &quot;MyView onTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.i(TAG, &quot;MyView onTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        boolean touch = super.onTouchEvent(event);</div><div class="line">        Log.i(TAG, &quot;MyView onTouchEvent--touch&quot; + touch);</div><div class="line">        return touch;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">public class MyViewGroup extends RelativeLayout &#123;</div><div class="line">    private String TAG = &quot;MyViewGroup&quot;;</div><div class="line"></div><div class="line">    public MyViewGroup(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">        TAG+=getTag();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line">        switch (ev.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.i(TAG, &quot;MyViewGroup dispatchTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.i(TAG, &quot;MyViewGroup dispatchTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.i(TAG, &quot;MyViewGroup dispatchTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        return super.dispatchTouchEvent(ev) ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</div><div class="line">        switch (ev.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.d(TAG, &quot;MyViewGroup onInterceptTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.d(TAG, &quot;MyViewGroup onInterceptTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.d(TAG, &quot;MyViewGroup onInterceptTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">       return super.onInterceptTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</div><div class="line">        switch (event.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.i(TAG, &quot;MyViewGroup onTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.i(TAG, &quot;MyViewGroup onTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.i(TAG, &quot;MyViewGroup onTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        boolean touch = super.onTouchEvent(event);</div><div class="line">        Log.i(TAG, &quot;MyViewGroup onTouchEvent--touch&quot; + touch);</div><div class="line">        return touch;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:id=&quot;@+id/activity_main&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    tools:context=&quot;com.jd.test.myapplication.MainActivity&quot;&gt;</div><div class="line"></div><div class="line">    &lt;com.jd.test.myapplication.view.MyViewGroup</div><div class="line">        android:id=&quot;@+id/mg1&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:tag=&quot;mg1&quot;&gt;</div><div class="line"></div><div class="line">        &lt;com.jd.test.myapplication.view.MyView</div><div class="line">            android:id=&quot;@+id/v3&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:tag=&quot;btn3&quot;</div><div class="line">            android:text=&quot;btn3&quot; /&gt;</div><div class="line">    &lt;/com.jd.test.myapplication.view.MyViewGroup&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">public class ViewEventActivity extends Activity &#123;</div><div class="line"></div><div class="line">    Button btn3;</div><div class="line">    MyViewGroup myViewGroup1;</div><div class="line">    private  String  TAG=&quot;ViewEventActivity&quot;;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_view_event);</div><div class="line">        btn3= (Button) findViewById(R.id.v3);</div><div class="line">        myViewGroup1= (MyViewGroup) findViewById(R.id.mg1);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line">        switch (ev.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.i(TAG, &quot;DecorView dispatchTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.i(TAG, &quot;DecorView dispatchTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.i(TAG, &quot;DecorView dispatchTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        return super.dispatchTouchEvent(ev);</div><div class="line">        //return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</div><div class="line">        switch (event.getAction()) &#123;</div><div class="line">            case MotionEvent.ACTION_DOWN:</div><div class="line">                Log.i(TAG, &quot;DecorView onTouchEvent--ACTION_DOWN&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_MOVE:</div><div class="line">                Log.i(TAG, &quot;DecorView onTouchEvent--ACTION_MOVE&quot;);</div><div class="line">                break;</div><div class="line">            case MotionEvent.ACTION_UP:</div><div class="line">                Log.i(TAG, &quot;DecorView onTouchEvent--ACTION_UP&quot;);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        boolean touch=super.onTouchEvent(event);</div><div class="line">        Log.d(TAG, &quot;DecorView touch boolean---&quot;+touch);</div><div class="line">        return touch;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h1 id="4-源码解析"><a href="#4-源码解析" class="headerlink" title="4.源码解析"></a>4.源码解析</h1><h2 id="1-Activity的TouchEvent流程"><a href="#1-Activity的TouchEvent流程" class="headerlink" title="1.Activity的TouchEvent流程"></a>1.Activity的TouchEvent流程</h2><p>首先看一下Activity的dispatchTouchEvnet源码，实际是调用了Window的 superDispatchTouchEvent();<br>Activity:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line">    if (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">        onUserInteraction();</div><div class="line">    &#125;</div><div class="line">    if (getWindow().superDispatchTouchEvent(ev)) &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">    return onTouchEvent(ev);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Window是一个抽象类，他的实现类是PhoneWindow，而PhoneWidow的最底层视图是mDecorView，是一个FrameLayout。其实也就是ViewGroup。<br>PhoneWindow:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean superDispatchTouchEvent(MotionEvent event) &#123;</div><div class="line">return mDecor.superDispatchTouchEvent(event);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>DecorView的 superDispatchTouchEvent<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public boolean superDispatchTouchEvent(MotionEvent event) &#123;</div><div class="line">return super.dispatchTouchEvent(event);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 如果Activity有实现 dispatchTouchEvent回调则调用改回调，若没有则调用super的 dispatchTouchEvent，继续往子View进行事件分发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line"> public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line"> final Callback cb = getCallback();</div><div class="line"> return cb != null &amp;&amp; !isDestroyed() &amp;&amp; mFeatureId &lt; 0 ? cb.dispatchTouchEvent(ev)</div><div class="line"> : super.dispatchTouchEvent(ev);</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h2 id="2-DispatchTouchEvent"><a href="#2-DispatchTouchEvent" class="headerlink" title="2.DispatchTouchEvent"></a>2.DispatchTouchEvent</h2><p>ViewGroup：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div></pre></td><td class="code"><pre><div class="line"> /**</div><div class="line">  * &#123;@inheritDoc&#125;</div><div class="line">  */</div><div class="line">  @Override</div><div class="line">  public boolean dispatchTouchEvent(MotionEvent ev) &#123;</div><div class="line">  if (mInputEventConsistencyVerifier != null) &#123;</div><div class="line">  mInputEventConsistencyVerifier.onTouchEvent(ev, 1);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">//对于辅助功能的事件处理</div><div class="line">  if (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) &#123;</div><div class="line">  ev.setTargetAccessibilityFocus(false);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  boolean handled = false;</div><div class="line">  if (onFilterTouchEventForSecurity(ev)) &#123;</div><div class="line">  final int action = ev.getAction();</div><div class="line">  final int actionMasked = action &amp; MotionEvent.ACTION_MASK;</div><div class="line"></div><div class="line">  // 处理原始的DOWN事件</div><div class="line">  if (actionMasked == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">  //这里主要是在新事件开始时处理完上一个事件</div><div class="line">  // due to an app switch, ANR, or some other state change.</div><div class="line">  cancelAndClearTouchTargets(ev);</div><div class="line">  resetTouchState();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //检查事件拦截</div><div class="line">  final boolean intercepted;</div><div class="line">  if (actionMasked == MotionEvent.ACTION_DOWN</div><div class="line">  || mFirstTouchTarget != null) &#123;</div><div class="line">  final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;</div><div class="line">  if (!disallowIntercept) &#123;</div><div class="line">  intercepted = onInterceptTouchEvent(ev);</div><div class="line">  ev.setAction(action); //恢复事件防止其改变</div><div class="line">  &#125; else &#123;</div><div class="line">  intercepted = false;</div><div class="line">  &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">  // There are no touch targets and this action is not an initial down</div><div class="line">  // so this view group continues to intercept touches.</div><div class="line">  intercepted = true;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //如果事件被拦截了，则进行正常的事件分发</div><div class="line">  if (intercepted || mFirstTouchTarget != null) &#123;</div><div class="line">  ev.setTargetAccessibilityFocus(false);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // 检查事件是否取消</div><div class="line">  final boolean canceled = resetCancelNextUpFlag(this)</div><div class="line">  || actionMasked == MotionEvent.ACTION_CANCEL;</div><div class="line"></div><div class="line">  // 如果有必要的话，为DOWN事件检查所有的目标对象</div><div class="line">  final boolean split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != 0;</div><div class="line">  TouchTarget newTouchTarget = null;</div><div class="line">  boolean alreadyDispatchedToNewTouchTarget = false;</div><div class="line"></div><div class="line">//如果事件未被取消并未被拦截</div><div class="line">  if (!canceled &amp;&amp; !intercepted) &#123;</div><div class="line"></div><div class="line">  //如果有辅助功能的参与，则直接将事件投递到对应的View，否则将事件分发给所有的子View</div><div class="line">  View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()</div><div class="line">  ? findChildWithAccessibilityFocus() : null;</div><div class="line"></div><div class="line">  if (actionMasked == MotionEvent.ACTION_DOWN</div><div class="line">  || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</div><div class="line">  || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</div><div class="line">  final int actionIndex = ev.getActionIndex(); // always 0 for down</div><div class="line">  final int idBitsToAssign = split ? 1 &lt;&lt; ev.getPointerId(actionIndex)</div><div class="line">  : TouchTarget.ALL_POINTER_IDS;</div><div class="line"></div><div class="line">  // Clean up earlier touch targets for this pointer id in case they</div><div class="line">  // have become out of sync.</div><div class="line">  removePointersFromTouchTargets(idBitsToAssign);</div><div class="line"></div><div class="line">  final int childrenCount = mChildrenCount;</div><div class="line"></div><div class="line">//如果TouchTarget为空并且子元素不为0</div><div class="line">  if (newTouchTarget == null &amp;&amp; childrenCount != 0) &#123;</div><div class="line">  final float x = ev.getX(actionIndex);</div><div class="line">  final float y = ev.getY(actionIndex);</div><div class="line">  //由上至下去寻找一个可以接收改事件的子View</div><div class="line">  final ArrayList&lt;View&gt; preorderedList = buildOrderedChildList();</div><div class="line">  final boolean customOrder = preorderedList == null</div><div class="line">  &amp;&amp; isChildrenDrawingOrderEnabled();</div><div class="line">  final View[] children = mChildren;</div><div class="line"></div><div class="line">//遍历子元素</div><div class="line">  for (int i = childrenCount - 1; i &gt;= 0; i--) &#123;</div><div class="line">  final int childIndex = customOrder</div><div class="line">  ? getChildDrawingOrder(childrenCount, i) : i;</div><div class="line">  final View child = (preorderedList == null)</div><div class="line">  ? children[childIndex] : preorderedList.get(childIndex);</div><div class="line"></div><div class="line">  // If there is a view that has accessibility focus we want it</div><div class="line">  // to get the event first and if not handled we will perform a</div><div class="line">  // normal dispatch. We may do a double iteration but this is</div><div class="line">  // safer given the timeframe.</div><div class="line">  if (childWithAccessibilityFocus != null) &#123;</div><div class="line">  if (childWithAccessibilityFocus != child) &#123;</div><div class="line">  continue;</div><div class="line">  &#125;</div><div class="line">  childWithAccessibilityFocus = null;</div><div class="line">  i = childrenCount - 1;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">//如果这个子元素无法接收Pointer Event或这个事件电压根本就没有在子元素的边界范围内</div><div class="line">  if (!canViewReceivePointerEvents(child)</div><div class="line">  || !isTransformedTouchPointInView(x, y, child, null)) &#123;</div><div class="line">  ev.setTargetAccessibilityFocus(false);</div><div class="line"></div><div class="line">//那么就跳出该次循环继续遍历</div><div class="line">  continue;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">//找到Event该由那个子元素持有</div><div class="line">  newTouchTarget = getTouchTarget(child);</div><div class="line">  if (newTouchTarget != null) &#123;</div><div class="line">  // Child is already receiving touch within its bounds.</div><div class="line">  // Give it the new pointer in addition to the ones it is handling.</div><div class="line">  newTouchTarget.pointerIdBits |= idBitsToAssign;</div><div class="line">  break;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  resetCancelNextUpFlag(child);</div><div class="line">//投递事件执行触摸操作</div><div class="line">//如果子元素还是一个ViewGroup，则递归调用重复此过程</div><div class="line">//如果子元素还是一个View，那么则会调用View的dispatTouchEvent，</div><div class="line">//并最终由onTouchEvent处理</div><div class="line"></div><div class="line">  if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) &#123;</div><div class="line">  // 子View在其边界范围内接收事件</div><div class="line">  mLastTouchDownTime = ev.getDownTime();</div><div class="line">  if (preorderedList != null) &#123;</div><div class="line">  // childIndex points into presorted list, find original index</div><div class="line">  for (int j = 0; j &lt; childrenCount; j++) &#123;</div><div class="line">  if (children[childIndex] == mChildren[j]) &#123;</div><div class="line">  mLastTouchDownIndex = j;</div><div class="line">  break;</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">  mLastTouchDownIndex = childIndex;</div><div class="line">  &#125;</div><div class="line">  mLastTouchDownX = ev.getX();</div><div class="line">  mLastTouchDownY = ev.getY();</div><div class="line">  newTouchTarget = addTouchTarget(child, idBitsToAssign);</div><div class="line">  alreadyDispatchedToNewTouchTarget = true;</div><div class="line">  break;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // The accessibility focus didn&apos;t handle the event, so clear</div><div class="line">  // the flag and do a normal dispatch to all children.</div><div class="line">  ev.setTargetAccessibilityFocus(false);</div><div class="line">  &#125;</div><div class="line">  if (preorderedList != null) preorderedList.clear();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">//如果发现没有子元素可以持有该次事件</div><div class="line">  if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) &#123;</div><div class="line">  // Did not find a child to receive the event.</div><div class="line">  // Assign the pointer to the least recently added target.</div><div class="line">  newTouchTarget = mFirstTouchTarget;</div><div class="line">  while (newTouchTarget.next != null) &#123;</div><div class="line">  newTouchTarget = newTouchTarget.next;</div><div class="line">  &#125;</div><div class="line">  newTouchTarget.pointerIdBits |= idBitsToAssign;</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // Dispatch to touch targets.</div><div class="line">  if (mFirstTouchTarget == null) &#123;</div><div class="line">  // No touch targets so treat this as an ordinary view.</div><div class="line">  handled = dispatchTransformedTouchEvent(ev, canceled, null,</div><div class="line">  TouchTarget.ALL_POINTER_IDS);</div><div class="line">  &#125; else &#123;</div><div class="line">  // Dispatch to touch targets, excluding the new touch target if we already</div><div class="line">  // dispatched to it. Cancel touch targets if necessary.</div><div class="line">  TouchTarget predecessor = null;</div><div class="line">  TouchTarget target = mFirstTouchTarget;</div><div class="line">  while (target != null) &#123;</div><div class="line">  final TouchTarget next = target.next;</div><div class="line">  if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</div><div class="line">  handled = true;</div><div class="line">  &#125; else &#123;</div><div class="line">  final boolean cancelChild = resetCancelNextUpFlag(target.child)</div><div class="line">  || intercepted;</div><div class="line">  if (dispatchTransformedTouchEvent(ev, cancelChild,</div><div class="line">  target.child, target.pointerIdBits)) &#123;</div><div class="line">  handled = true;</div><div class="line">  &#125;</div><div class="line">  if (cancelChild) &#123;</div><div class="line">  if (predecessor == null) &#123;</div><div class="line">  mFirstTouchTarget = next;</div><div class="line">  &#125; else &#123;</div><div class="line">  predecessor.next = next;</div><div class="line">  &#125;</div><div class="line">  target.recycle();</div><div class="line">  target = next;</div><div class="line">  continue;</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line">  predecessor = target;</div><div class="line">  target = next;</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // Update list of touch targets for pointer up or cancel, if needed.</div><div class="line">  if (canceled</div><div class="line">  || actionMasked == MotionEvent.ACTION_UP</div><div class="line">  || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</div><div class="line">  resetTouchState();</div><div class="line">  &#125; else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</div><div class="line">  final int actionIndex = ev.getActionIndex();</div><div class="line">  final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex);</div><div class="line">  removePointersFromTouchTargets(idBitsToRemove);</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (!handled &amp;&amp; mInputEventConsistencyVerifier != null) &#123;</div><div class="line">  mInputEventConsistencyVerifier.onUnhandledEvent(ev, 1);</div><div class="line">  &#125;</div><div class="line">  return handled;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>View：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* Dispatches a key shortcut event.</div><div class="line">*</div><div class="line">* @param event The key event to be dispatched.</div><div class="line">* @return True if the event was handled by the view, false otherwise.</div><div class="line">*/</div><div class="line">public boolean dispatchKeyShortcutEvent(KeyEvent event) &#123;</div><div class="line">return onKeyShortcut(event.getKeyCode(), event);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">* Pass the touch screen motion event down to the target view, or this</div><div class="line">* view if it is the target.</div><div class="line">*</div><div class="line">* @param event The motion event to be dispatched.</div><div class="line">* @return True if the event was handled by the view, false otherwise.</div><div class="line">*/</div><div class="line">public boolean dispatchTouchEvent(MotionEvent event) &#123;</div><div class="line">// If the event should be handled by accessibility focus first.</div><div class="line">if (event.isTargetAccessibilityFocus()) &#123;</div><div class="line">// We don&apos;t have focus or no virtual descendant has it, do not handle the event.</div><div class="line">if (!isAccessibilityFocusedViewOrHost()) &#123;</div><div class="line">return false;</div><div class="line">&#125;</div><div class="line">// We have focus and got the event, then use normal event dispatch.</div><div class="line">event.setTargetAccessibilityFocus(false);</div><div class="line">&#125;</div><div class="line"></div><div class="line">boolean result = false;</div><div class="line"></div><div class="line">if (mInputEventConsistencyVerifier != null) &#123;</div><div class="line">mInputEventConsistencyVerifier.onTouchEvent(event, 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">final int actionMasked = event.getActionMasked();</div><div class="line">if (actionMasked == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">// Defensive cleanup for new gesture</div><div class="line">stopNestedScroll();</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (onFilterTouchEventForSecurity(event)) &#123;</div><div class="line">//noinspection SimplifiableIfStatement</div><div class="line">ListenerInfo li = mListenerInfo;</div><div class="line">if (li != null &amp;&amp; li.mOnTouchListener != null</div><div class="line">&amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</div><div class="line">&amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123;</div><div class="line">result = true;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (!result &amp;&amp; onTouchEvent(event)) &#123;</div><div class="line">result = true;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (!result &amp;&amp; mInputEventConsistencyVerifier != null) &#123;</div><div class="line">mInputEventConsistencyVerifier.onUnhandledEvent(event, 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Clean up after nested scrolls if this is the end of a gesture;</div><div class="line">// also cancel it if we tried an ACTION_DOWN but we didn&apos;t want the rest</div><div class="line">// of the gesture.</div><div class="line">if (actionMasked == MotionEvent.ACTION_UP ||</div><div class="line">actionMasked == MotionEvent.ACTION_CANCEL ||</div><div class="line">(actionMasked == MotionEvent.ACTION_DOWN &amp;&amp; !result)) &#123;</div><div class="line">stopNestedScroll();</div><div class="line">&#125;</div><div class="line"></div><div class="line">return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-onInterceptTouchEvent"><a href="#3-onInterceptTouchEvent" class="headerlink" title="3.onInterceptTouchEvent"></a>3.onInterceptTouchEvent</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</div><div class="line"> return false;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="4-TouchEvent"><a href="#4-TouchEvent" class="headerlink" title="4.TouchEvent"></a>4.TouchEvent</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* Implement this method to handle touch screen motion events.</div><div class="line">* &lt;p&gt;</div><div class="line">* If this method is used to detect click actions, it is recommended that</div><div class="line">* the actions be performed by implementing and calling</div><div class="line">* &#123;@link #performClick()&#125;. This will ensure consistent system behavior,</div><div class="line">* including:</div><div class="line">* &lt;ul&gt;</div><div class="line">* &lt;li&gt;obeying click sound preferences</div><div class="line">* &lt;li&gt;dispatching OnClickListener calls</div><div class="line">* &lt;li&gt;handling &#123;@link AccessibilityNodeInfo#ACTION_CLICK ACTION_CLICK&#125; when</div><div class="line">* accessibility features are enabled</div><div class="line">* &lt;/ul&gt;</div><div class="line">*</div><div class="line">* @param event The motion event.</div><div class="line">* @return True if the event was handled, false otherwise.</div><div class="line">*/</div><div class="line">public boolean onTouchEvent(MotionEvent event) &#123;</div><div class="line">final float x = event.getX();</div><div class="line">final float y = event.getY();</div><div class="line">final int viewFlags = mViewFlags;</div><div class="line">final int action = event.getAction();</div><div class="line"></div><div class="line">if ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;</div><div class="line">if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123;</div><div class="line">setPressed(false);</div><div class="line">&#125;</div><div class="line">// A disabled view that is clickable still consumes the touch</div><div class="line">// events, it just doesn&apos;t respond to them.</div><div class="line">return (((viewFlags &amp; CLICKABLE) == CLICKABLE</div><div class="line">|| (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)</div><div class="line">|| (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE);</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (mTouchDelegate != null) &#123;</div><div class="line">if (mTouchDelegate.onTouchEvent(event)) &#123;</div><div class="line">return true;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (((viewFlags &amp; CLICKABLE) == CLICKABLE ||</div><div class="line">(viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) ||</div><div class="line">(viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE) &#123;</div><div class="line">switch (action) &#123;</div><div class="line">case MotionEvent.ACTION_UP:</div><div class="line">boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;</div><div class="line">if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) &#123;</div><div class="line">// take focus if we don&apos;t have it already and we should in</div><div class="line">// touch mode.</div><div class="line">boolean focusTaken = false;</div><div class="line">if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;</div><div class="line">focusTaken = requestFocus();</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (prepressed) &#123;</div><div class="line">// The button is being released before we actually</div><div class="line">// showed it as pressed. Make it show the pressed</div><div class="line">// state now (before scheduling the click) to ensure</div><div class="line">// the user sees it.</div><div class="line">setPressed(true, x, y);</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123;</div><div class="line">// This is a tap, so remove the longpress check</div><div class="line">removeLongPressCallback();</div><div class="line"></div><div class="line">// Only perform take click actions if we were in the pressed state</div><div class="line">if (!focusTaken) &#123;</div><div class="line">// Use a Runnable and post this rather than calling</div><div class="line">// performClick directly. This lets other visual state</div><div class="line">// of the view update before click actions start.</div><div class="line">if (mPerformClick == null) &#123;</div><div class="line">mPerformClick = new PerformClick();</div><div class="line">&#125;</div><div class="line">if (!post(mPerformClick)) &#123;</div><div class="line">performClick();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (mUnsetPressedState == null) &#123;</div><div class="line">mUnsetPressedState = new UnsetPressedState();</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (prepressed) &#123;</div><div class="line">postDelayed(mUnsetPressedState,</div><div class="line">ViewConfiguration.getPressedStateDuration());</div><div class="line">&#125; else if (!post(mUnsetPressedState)) &#123;</div><div class="line">// If the post failed, unpress right now</div><div class="line">mUnsetPressedState.run();</div><div class="line">&#125;</div><div class="line"></div><div class="line">removeTapCallback();</div><div class="line">&#125;</div><div class="line">mIgnoreNextUpEvent = false;</div><div class="line">break;</div><div class="line"></div><div class="line">case MotionEvent.ACTION_DOWN:</div><div class="line">mHasPerformedLongPress = false;</div><div class="line"></div><div class="line">if (performButtonActionOnTouchDown(event)) &#123;</div><div class="line">break;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Walk up the hierarchy to determine if we&apos;re inside a scrolling container.</div><div class="line">boolean isInScrollingContainer = isInScrollingContainer();</div><div class="line"></div><div class="line">// For views inside a scrolling container, delay the pressed feedback for</div><div class="line">// a short period in case this is a scroll.</div><div class="line">if (isInScrollingContainer) &#123;</div><div class="line">mPrivateFlags |= PFLAG_PREPRESSED;</div><div class="line">if (mPendingCheckForTap == null) &#123;</div><div class="line">mPendingCheckForTap = new CheckForTap();</div><div class="line">&#125;</div><div class="line">mPendingCheckForTap.x = event.getX();</div><div class="line">mPendingCheckForTap.y = event.getY();</div><div class="line">postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());</div><div class="line">&#125; else &#123;</div><div class="line">// Not inside a scrolling container, so show the feedback right away</div><div class="line">setPressed(true, x, y);</div><div class="line">checkForLongClick(0);</div><div class="line">&#125;</div><div class="line">break;</div><div class="line"></div><div class="line">case MotionEvent.ACTION_CANCEL:</div><div class="line">setPressed(false);</div><div class="line">removeTapCallback();</div><div class="line">removeLongPressCallback();</div><div class="line">mInContextButtonPress = false;</div><div class="line">mHasPerformedLongPress = false;</div><div class="line">mIgnoreNextUpEvent = false;</div><div class="line">break;</div><div class="line"></div><div class="line">case MotionEvent.ACTION_MOVE:</div><div class="line">drawableHotspotChanged(x, y);</div><div class="line"></div><div class="line">// Be lenient about moving outside of buttons</div><div class="line">if (!pointInView(x, y, mTouchSlop)) &#123;</div><div class="line">// Outside button</div><div class="line">removeTapCallback();</div><div class="line">if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123;</div><div class="line">// Remove any future long press/tap checks</div><div class="line">removeLongPressCallback();</div><div class="line"></div><div class="line">setPressed(false);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">break;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return true;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/14/设计模式-责任链模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/14/设计模式-责任链模式/" itemprop="url">
                  设计模式-责任链模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-14T09:35:49+08:00">
                2017-02-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/14/设计模式-责任链模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/14/设计模式-责任链模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-责任链模式的定义及使用场景"><a href="#1-责任链模式的定义及使用场景" class="headerlink" title="1.责任链模式的定义及使用场景"></a>1.责任链模式的定义及使用场景</h2><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><p>责任链模式是行为型设计模式之一。使多个对象都有机会处理请求，从而避免了请求的发送者和接受者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有对象处理它为止</p>
<p>###使用场景：<br>使多个对象都有机会处理请求，从而避免了请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，只到有对象处理它为止<br><img src="http://img.blog.csdn.net/20170214090047528?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="责任链模式"></p>
<h2 id="2-责任链模式的优缺点"><a href="#2-责任链模式的优缺点" class="headerlink" title="2 . 责任链模式的优缺点"></a>2 . 责任链模式的优缺点</h2><h3 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h3><p>责任链模式非常显著的优点是将请求和处理分开。请求者可以不用知道是谁处理，处理者可以不用知道请求的全貌，两者解耦，提高系统的灵活性</p>
<h3 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h3><p>责任链有两个非常显著的缺点：一是性能问题，每个请求都是从链头遍历到链尾，特别是在链比较长的时候，性能是一个比较大的问题；<br>二是调试不很方便，特别是链条比较长，环节比较多的时候，由于采用了类似递归的方式，调试的时候逻辑可能比较复杂</p>
<h2 id="3-注意实现"><a href="#3-注意实现" class="headerlink" title="3.注意实现"></a>3.注意实现</h2><p>链中节点数量需要控制，避免出现超长链的情况，一般的做法是在handler<br>中设置一个最大节点数量，在setNext方法中判断是否已经是超过其阈值，超过则不允许该链建立，避免无意识地破坏系统性能</p>
<h2 id="4-责任链模式的实现方式"><a href="#4-责任链模式的实现方式" class="headerlink" title="4. 责任链模式的实现方式"></a>4. 责任链模式的实现方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public abstract class AbstractRequest &#123;</div><div class="line">    private Object obj;//处理对象</div><div class="line"></div><div class="line">    public AbstractRequest(Object object) &#123;</div><div class="line">        this.obj = object;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Object getContent() &#123;</div><div class="line">        return obj;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //获取请求的级别</div><div class="line">    public abstract int getRequestLevel();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public abstract class AbstractHandler &#123;</div><div class="line">    protected AbstractHandler nexthandler;//下一节点处理对象</div><div class="line"></div><div class="line">    public final void handleRequest(AbstractRequest request) &#123;</div><div class="line">        if(getHandleLevel()==request.getRequestLevel())&#123;</div><div class="line">            handle(request);</div><div class="line">        &#125;else&#123;</div><div class="line">            if(nexthandler!=null)&#123;</div><div class="line">                nexthandler.handleRequest(request);</div><div class="line">            &#125;else&#123;</div><div class="line">                System.out.println(&quot;All of handler can not handle the request&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //获取处理者对象的处理级别</div><div class="line">    protected abstract int getHandleLevel();</div><div class="line"></div><div class="line">    //每个处理者对象的具体处理方式</div><div class="line">    protected abstract void handle(AbstractRequest request);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class Handler1 extends AbstractHandler &#123;</div><div class="line">    @Override</div><div class="line">    protected int getHandleLevel() &#123;</div><div class="line">        return 1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void handle(AbstractRequest request) &#123;</div><div class="line">        System.out.println(&quot;Handler1 handle request:&quot;+request.getRequestLevel());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class Handler2 extends AbstractHandler &#123;</div><div class="line">    @Override</div><div class="line">    protected int getHandleLevel() &#123;</div><div class="line">        return 2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void handle(AbstractRequest request) &#123;</div><div class="line">        System.out.println(&quot;Handler2 handle request:&quot;+request.getRequestLevel());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class Handler3 extends AbstractHandler &#123;</div><div class="line">    @Override</div><div class="line">    protected int getHandleLevel() &#123;</div><div class="line">        return 3;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void handle(AbstractRequest request) &#123;</div><div class="line">        System.out.println(&quot;Handler3 handle request:&quot;+request.getRequestLevel());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Request1 extends  AbstractRequest &#123;</div><div class="line">    public Request1(Object object) &#123;</div><div class="line">        super(object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getRequestLevel() &#123;</div><div class="line">        return 1;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Request2 extends  AbstractRequest &#123;</div><div class="line">    public Request2(Object object) &#123;</div><div class="line">        super(object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getRequestLevel() &#123;</div><div class="line">        return 2;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Request3 extends  AbstractRequest &#123;</div><div class="line">    public Request3(Object object) &#123;</div><div class="line">        super(object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getRequestLevel() &#123;</div><div class="line">        return 3;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Request4 extends  AbstractRequest &#123;</div><div class="line">    public Request4(Object object) &#123;</div><div class="line">        super(object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getRequestLevel() &#123;</div><div class="line">        return 4;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line"></div><div class="line">    public static void main(String args[]) &#123;</div><div class="line">        AbstractHandler h1=new Handler1();</div><div class="line">        AbstractHandler h2=new Handler2();</div><div class="line">        AbstractHandler h3=new Handler3();</div><div class="line">        h1.nexthandler=h2;</div><div class="line">        h2.nexthandler=h3;</div><div class="line"></div><div class="line">        AbstractRequest r1=new Request1(h1);</div><div class="line">        AbstractRequest r2=new Request2(h2);</div><div class="line">        AbstractRequest r3=new Request3(h3);</div><div class="line">        AbstractRequest r4=new Request4(h3);</div><div class="line">        //总是从链式的首端发起请求</div><div class="line">        h1.handleRequest(r1);</div><div class="line">        h1.handleRequest(r2);</div><div class="line">        h1.handleRequest(r3);</div><div class="line">        h1.handleRequest(r4);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5-责任链模式在Android中的实际应用"><a href="#5-责任链模式在Android中的实际应用" class="headerlink" title="5. 责任链模式在Android中的实际应用"></a>5. 责任链模式在Android中的实际应用</h2><p>责任链模式在Android源码中比较类似的实现就是对于触摸事件的分发处理。每当用户接触屏幕时，Android都会将对应的事件包装成一个事件对象从ViewTree的顶部至上而下地分发传递。ViewGroup事件投递的递归调用就类似于一条责任链，一旦寻找到责任者，那么将由责任者持有并消费掉该次事件，具体地体现在View的onTouchEvent方法中返回值的设置，如果onTouchEvent返回false，那么意味着当前View不会是该次事件的复制人，将不会对其持有；如果为true则相反，此时View会持有该事件并不再向外传递。<br>View的事件分发机制（MontionEvent的分发过程）：<br>public boolean dispatchTouchEvent（MotionEvent ev）<br>如果事件能够传递到当前的View，那么此方法一定会被调用。<br>public boolean onInterceptTouchEvent（MotionEvent ev）<br>用来判断是否拦截某个事件<br>public boolean onTouchEvent(MotionEvent ev)<br>用来处理点击事件<br>流转关系（伪代码）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public boolean dispatchTouchEvent(MotionEvent ev)&#123;</div><div class="line">     boolean consume=false;</div><div class="line">     if(onInterceptTouchEvent(ev))&#123;</div><div class="line">          consume=onTouchEvent(ev);</div><div class="line">     &#125;else&#123;</div><div class="line">          consume=child.dispatchTouchEvent(ev);</div><div class="line">     &#125;</div><div class="line">     return consume;</div><div class="line">     &#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/08/设计模式-命令模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/设计模式-命令模式/" itemprop="url">
                  设计模式-命令模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T19:24:00+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/设计模式-命令模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/设计模式-命令模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-命令模式的定义及使用场景"><a href="#1-命令模式的定义及使用场景" class="headerlink" title="1.命令模式的定义及使用场景"></a>1.命令模式的定义及使用场景</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>命令模式是行为型设计模式之一。将一个请求封装成一个对象，从而让用户使用不同的请求把客户端参数化；对请求排队或者记录请求日志，以支持可撤销的操作</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><ul>
<li><p>需要抽象出待执行的动作，然后以参数的形式提供出来，类似于过程设计中的回调机制，而命令模式正是回调机制的一个面向对象的替代品。<br>在不同的时刻指定、排列和执行请求。一个命令对象可以有与初始请求无关的生存期。</p>
</li>
<li><p>需要支持取消操作。</p>
</li>
<li>支持修改日志功能，这样当系统奔溃时，这些修改可以被重做一遍。</li>
<li>需要支持事务操作。</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170208192136610?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<h1 id="2-命令模式的优缺点"><a href="#2-命令模式的优缺点" class="headerlink" title="2. 命令模式的优缺点"></a>2. 命令模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><ul>
<li>类间解耦<br>调用者角色与接受者角色之间没有任何依赖关系，调用者实现功能时只需要调用Command抽象类的execute方法就可以，不需要了解到底是那个接受者执行</li>
<li>可扩展性<br>Command的子类可以非常容易地扩展，而调用者Invoker和高层次的模块Client不产生严重的代码耦合</li>
<li>命令模式结合其他模式会更优秀<br>命令模式可以结合责任链模式，实现命令族解析任务；结合模板方法模式，则可以减少Command子类的膨胀问题<h2 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h2>命令模式也是有缺点的，请看Command的子类；如果有N个命令，问题就出来了，Command的子类就可不是几个，而是N个，这个类膨胀得非常大，这个就需要读者在项目中慎重考虑<h1 id="3-注意事项"><a href="#3-注意事项" class="headerlink" title="3.注意事项"></a>3.注意事项</h1>对于命令模式，大家可能 心存疑虑，明明是一个很简单的调用逻辑，为什么要做如此的复杂，为什么不直接reciver的excute方法就可以实现功能？<br>调用逻辑复杂，是为了如果后续命令的增加， 能够应对后续需求的变化。简单的只是开发起来方便，但对后续的维护则是困难。<br>除此之外，使用命令模式的另一个好处是可以实现命令记录的功能，可以在调用者里面使用一个数据结构来存储执行过的命令对象，以此可以方便地知道刚刚执行过哪些命令，并可以在需要是恢复。并且可以在调用者中执行日志的记录。<h1 id="4-命令模式的实现方式"><a href="#4-命令模式的实现方式" class="headerlink" title="4. 命令模式的实现方式"></a>4. 命令模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public abstract class Command &#123;  </div><div class="line">    //执行具体操作命令  </div><div class="line">    public  abstract void execute();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class ConcreteCommand1 extends Command &#123;  </div><div class="line">    private  Receiver receiver;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public ConcreteCommand1() &#123;  </div><div class="line">        this.receiver = new ConcreteReceiver1();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void setReceiver(Receiver receiver) &#123;  </div><div class="line">        this.receiver = receiver;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    @Override  </div><div class="line">    public void execute() &#123;  </div><div class="line">        if(receiver!=null)&#123;  </div><div class="line">            receiver.doSomething();  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class ConcreteCommand2 extends Command &#123;  </div><div class="line">    private  Receiver receiver;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public ConcreteCommand2() &#123;  </div><div class="line">        this.receiver = new ConcreteReceiver2();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void setReceiver(Receiver receiver) &#123;  </div><div class="line">        this.receiver = receiver;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    @Override  </div><div class="line">    public void execute() &#123;  </div><div class="line">        if(receiver!=null)&#123;  </div><div class="line">            receiver.doSomething();  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public abstract  class Receiver &#123;  </div><div class="line">    public abstract void doSomething();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class ConcreteReceiver1 extends Receiver &#123;  </div><div class="line">    @Override  </div><div class="line">    public void doSomething() &#123;  </div><div class="line">        System.out.println(&quot;ConcreteReceiver1 do...&quot;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class ConcreteReceiver2 extends Receiver &#123;  </div><div class="line">    @Override  </div><div class="line">    public void doSomething() &#123;  </div><div class="line">        System.out.println(&quot;ConcreteReceiver2 do...&quot;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class Invoker &#123;  </div><div class="line">    private Command command;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void setCommand(Command command) &#123;  </div><div class="line">        this.command = command;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void action() &#123;  </div><div class="line">        this.command.execute();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public static void main(String args[]) &#123;  </div><div class="line">        Invoker invoker = new Invoker();  </div><div class="line">        Receiver receiver = new ConcreteReceiver1();  </div><div class="line">        Command command = new ConcreteCommand1();  </div><div class="line">        invoker.setCommand(command);  </div><div class="line">        invoker.action();  </div><div class="line">        Receiver receiver2 = new ConcreteReceiver2();  </div><div class="line">        Command command2 = new ConcreteCommand2();  </div><div class="line">        invoker.setCommand(command2);  </div><div class="line">        invoker.action();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2017/02/07/设计模式-中介者模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄俊彬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黄俊彬个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/07/设计模式-中介者模式/" itemprop="url">
                  设计模式-中介者模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-07T09:04:26+08:00">
                2017-02-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/07/设计模式-中介者模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/07/设计模式-中介者模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-中介者模式的定义及使用场景"><a href="#1-中介者模式的定义及使用场景" class="headerlink" title="1.中介者模式的定义及使用场景"></a>1.中介者模式的定义及使用场景</h1><h2 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h2><p>中介者模式包装了一系列对象相互作用的方式，使得这些对象不必相互明显作用。从而使他们可以松散耦合。当某些对象之间的作用发生改变时，不会立即影响其他的一些对象之间的作用。保证这些作用可以彼此独立的变化。中介者模式将多对多的相互作用转化为一对多的相互作用。中介者模式将对象的行为和协作抽象化，把对象在小尺度的行为上与其他对象的相互作用分开处理。</p>
<h2 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h2><p>当对象之间的交互操作很多且每个对象的行为操作都彼此依赖时，为防止在修改一个对象的行为时，同时涉及修改很多其他对象的行为，可采用中介者模式，来解决紧耦合问题。该模式将对象之间的多对多关系变成一对多关系，中介者对象将系统从网状结构变成以调停者为中心的星形结构，达到降低系统的复杂性，提高可扩展的作用。</p>
<p><img src="http://img.blog.csdn.net/20170207090120031?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvanVuYmluMTAxMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<h1 id="2-中介者模式的优缺点"><a href="#2-中介者模式的优缺点" class="headerlink" title="2.中介者模式的优缺点"></a>2.中介者模式的优缺点</h1><h2 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h2><p>中介者的模式的优点就是减少类间的依赖，把原有的一对多的依赖变成一对一的依赖，同事类只依赖中介者，减少依赖，当然同时也降低了类间的耦合</p>
<p>##2.2缺点<br>中介者模式的缺点就是中介者会膨胀得很大，而且逻辑复杂，原本N个对象直接的相互依赖关系转换为中介者和同事类的依赖关系，同事类约多，中介者的逻辑就越复杂</p>
<h1 id="3-注意实现"><a href="#3-注意实现" class="headerlink" title="3.注意实现"></a>3.注意实现</h1><p>中介者模式是一个非常好的封装模式，也是一个很容易被滥用的模式，一个对象依赖几个对象是再正常不过的事情，但是纯理论家就会要求使用中介者模式来封装这种依赖关系，这是非常危险的！使用中介者模式就必然会带来中介者的膨胀问题，这在一个项目中是很不恰当的。可以在如下的情况尝试使用中介者模式：</p>
<ul>
<li>N个对象直接产生了相互的依赖关系（N&gt;2）</li>
<li>对个对象有依赖关系，但是依赖的行为尚不确定或者有发送改变的可能，在这种情况下一般建议采用中介者模式，降低变更引起的风险扩散</li>
<li>产品开发。一个明显的例子就是MVC框架，把中介者模式应用到产品中，可以提升产品的性能扩展性，但是对于项目开发就未必，因为项目是以交付投产为目标，而产品是以稳定、高效、扩展为宗旨。<h1 id="4-中介者模式的实现方式"><a href="#4-中介者模式的实现方式" class="headerlink" title="4.中介者模式的实现方式"></a>4.中介者模式的实现方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public abstract class Colleague &#123;  </div><div class="line">    Mediator mediator;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public Colleague(Mediator mediator) &#123;  </div><div class="line">        this.mediator = mediator;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public abstract void action();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class ConcreteColleagueA extends Colleague &#123;  </div><div class="line">    public ConcreteColleagueA(Mediator mediator) &#123;  </div><div class="line">        super(mediator);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    @Override  </div><div class="line">    public void action() &#123;  </div><div class="line">        System.out.println(&quot;ColleagueA do action!&quot;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void doPrivateA() &#123;  </div><div class="line">        System.out.println(&quot;ColleagueA do private!&quot;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class ConcreteColleagueB extends Colleague &#123;  </div><div class="line">    public ConcreteColleagueB(Mediator mediator) &#123;  </div><div class="line">        super(mediator);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    @Override  </div><div class="line">    public void action() &#123;  </div><div class="line">        System.out.println(&quot;ColleagueB do action!&quot;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void doPrivateB() &#123;  </div><div class="line">        System.out.println(&quot;ColleagueB do private!&quot;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> public abstract class Mediator &#123;  </div><div class="line">    protected ConcreteColleagueA concreteColleagueA;  </div><div class="line">    protected  ConcreteColleagueB concreteColleagueB;  </div><div class="line">    public abstract void method();  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void setConcreteColleagueA(ConcreteColleagueA concreteColleagueA) &#123;  </div><div class="line">        this.concreteColleagueA = concreteColleagueA;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">    public void setConcreteColleagueB(ConcreteColleagueB concreteColleagueB) &#123;  </div><div class="line">        this.concreteColleagueB = concreteColleagueB;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class ConcreteMediator extends Mediator &#123;  </div><div class="line">    @Override  </div><div class="line">    public void method() &#123;  </div><div class="line">        concreteColleagueA.action();  </div><div class="line">        concreteColleagueB.action();  </div><div class="line">        concreteColleagueA.doPrivateA();  </div><div class="line">        concreteColleagueB.doPrivateB();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="5-中介者模式在Android中的实际应用"><a href="#5-中介者模式在Android中的实际应用" class="headerlink" title="5.中介者模式在Android中的实际应用"></a>5.中介者模式在Android中的实际应用</h1><p>Android的Activity实际就是一个中介者模式，形形式式的View交互都在Activity中统一执行，View之间彼此不交互。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://avatar.csdn.net/0/6/2/1_junbin1011.jpg"
               alt="黄俊彬" />
          <p class="site-author-name" itemprop="name">黄俊彬</p>
           
              <p class="site-description motion-element" itemprop="description">优秀是一种习惯，坚持是一种品质。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">75</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/junbin1011" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/huang-jun-bin-48/" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">黄俊彬</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"junbin"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
